record(bo, "$(Sys)$(Dev)Init-Cmd")
{
    field(DTYP, "stream")
    field(DESC, "Init")
    field(OUT,  "@R4K_80.proto init($(Chan)) $(PORT)")
    field(PINI, "1")
}

# Voltage readback
record(ai, "$(Sys)$(Dev)V")
{
	field(DTYP, "stream")
	field(DESC, "Voltage")
	field(INP,  "@R4K_80.proto ReadV($(Chan)) $(PORT)")
	field(EGU,  "V")
	field(PREC, ".001")
	field(SCAN, ".1 second")
}

# Current readback
record(ai, "$(Sys)$(Dev)I")
{
	field(DTYP, "stream")
	field(DESC, "Current")
	field(INP,  "@R4K_80.proto ReadI($(Chan)) $(PORT)")
	field(EGU,  "A")
	field(PREC, ".001")
	field(SCAN, ".1 second")
}

# Voltage setpoint
record(ao, "$(Sys)$(Dev)V:SP")
{
	field(DTYP, "stream")
	field(DESC, "Voltage SP")
	field(OUT,  "@R4K_80.proto WriteVSP($(Chan)) $(PORT)")
	field(EGU,  "V")
	field(PREC, ".001")
    field(PINI, "1")
    info(autosaveFields, "VAL")    
}

# Voltage setpoint RB
record(ai, "$(Sys)$(Dev)V:SP-RB")
{
	field(DTYP, "stream")
	field(DESC, "Voltage SP RBV")
	field(INP,  "@R4K_80.proto ReadVSP($(Chan)) $(PORT)")
	field(EGU,  "V")
	field(PREC, ".001")
	field(SCAN, ".1 second")
}

# Current setpoint
record(ao, "$(Sys)$(Dev)I:SP")
{
	field(DTYP, "stream")
	field(DESC, "Current SP")
	field(OUT,  "@R4K_80.proto WriteISP($(Chan)) $(PORT)")
	field(EGU,  "A")
	field(PREC, ".001")
    field(PINI, "1")
    info(autosaveFields, "VAL")    
}

# Current setpoint RB
record(ai, "$(Sys)$(Dev)I:SP-RB")
{
	field(DTYP, "stream")
	field(DESC, "Current SP RBV")
	field(INP,  "@R4K_80.proto ReadISP($(Chan)) $(PORT)")
	field(EGU,  "A")
	field(PREC, ".001")
	field(SCAN, ".1 second")
}

# Over Voltage Protection (OVP)
record(ao, "$(Sys)$(Dev)OVP")
{
	field(DTYP, "stream")
	field(DESC, "Over Voltage Protection")
	field(OUT,  "@R4K_80.proto WriteOVP($(Chan)) $(PORT)")
	field(EGU,  "V")
	field(PREC, ".001")
    field(PINI, "1")
    info(autosaveFields, "VAL")    
}

# Over Voltage Protection (OVP) RB
record(ai, "$(Sys)$(Dev)OVP-RB")
{
	field(DTYP, "stream")
	field(DESC, "Over Voltage Protection RBV")
	field(INP,  "@R4K_80.proto ReadOVP($(Chan)) $(PORT)")
	field(EGU,  "V")
	field(PREC, ".001")
	field(SCAN, ".1 second")
}

# Over Current Protection (OCP)
record(ao, "$(Sys)$(Dev)OCP")
{
	field(DTYP, "stream")
	field(DESC, "Over Current Protection")
	field(OUT,  "@R4K_80.proto WriteOCP($(Chan)) $(PORT)")
	field(EGU,  "A")
	field(PREC, ".001")
    field(PINI, "1")
    info(autosaveFields, "VAL")    
}

# Over Current Protection (OCP) RB
record(ai, "$(Sys)$(Dev)OCP-RB")
{
	field(DTYP, "stream")
	field(DESC, "Over Current Protection RBV")
	field(INP,  "@R4K_80.proto ReadOCP($(Chan)) $(PORT)")
	field(EGU,  "A")
	field(PREC, ".001")
	field(SCAN, ".1 second")
}


# Output enable
record(bo, "$(Sys)$(Dev)OUTPUT")
{
	field(DTYP, "stream")
	field(DESC, "Output enable")
    field(ZNAM, "Off")
    field(ONAM, "On")    
	field(OUT,  "@R4K_80.proto WriteOutputEnable($(Chan)) $(PORT)")
    field(PINI, "1")
    info(autosaveFields, "VAL")    
}

# Output enable RB
record(bi, "$(Sys)$(Dev)OUTPUT-RB")
{
	field(DTYP, "stream")
	field(DESC, "Output enable RBV")
    field(ZNAM, "Off")
    field(ONAM, "On")    
	field(INP,  "@R4K_80.proto ReadOutputEnable($(Chan)) $(PORT)")
	field(SCAN, ".1 second")
}

# Status string. The string contains status codes separated by SP.
# EXAMPLE: CO RM CV
# STATUS CODES:
# CF - Output cut off status
# CO - Output enable status
# LO - Local mode
# RM - Remote mode
# CC - Constant current mode
# CV - Constant voltage mode
# OVP - Over voltage protection
# OCP - Over current protection
# OT - Over temperature protection
# ACF - AC input fault
# RS - Sense reverse connect
# LD - Inter Lock off
record(stringin, "$(Sys)$(Dev)STS")
{
	field(DTYP, "stream")
	field(DESC, "Device status")
	field(INP,  "@R4K_80.proto ReadSTS($(Chan)) $(PORT)")
	field(SCAN, ".1 second")
    field(FLNK, "$(Sys)$(Dev)STS:BITS_")	
}

# Convert status string to status BITS
record(aSub, "$(Sys)$(Dev)STS:BITS_")
{
	field(DESC, "Device status (BITS)")
	field(INAM, "aSub_R4K_80_STS_Init")
	field(SNAM, "aSub_R4K_80_STS_Proc")
	field(INPA, "$(Sys)$(Dev)STS")
    field(FTA, "STRING")
    field(NOA, "50")
	field(OUTA, "$(Sys)$(Dev)STS:BITS")
	field(FTVA, "SHORT")
	field(NOVA, "1")
    field(FLNK, "$(Sys)$(Dev)STS:BITS")	
}

# Status bits:
# Bit 0:  CF - Output cut off status
# Bit 1:  CO - Output enable status
# Bit 2:  LO - Local mode
# Bit 3:  RM - Remote mode
# Bit 4:  CC - Constant current mode
# Bit 5:  CV - Constant voltage mode
# Bit 6:  OVP - Over voltage protection
# Bit 7:  OCP - Over current protection
# Bit 8:  OT - Over temperature protection
# Bit 9:  ACF - AC input fault
# Bit 10: RS - Sense reverse connect
# Bit 11: LD - Inter Lock off
record(ai, "$(Sys)$(Dev)STS:BITS")
{
	field(DESC, "Device status (BITS)")
	field(INP,  "$(Sys)$(Dev)STS:BITS_.VALA")
}
